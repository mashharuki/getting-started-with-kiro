# Playwright MCPでテストしてみよう

このチュートリアルでは、KiroのMCP（Model Context Protocol）機能を使ってPlaywrightによる自動テストを実装します。MCPの概念を理解し、実際のWebアプリケーションに対する自動テストを作成・実行する方法を学びましょう。

## 学習目標

- MCP（Model Context Protocol）の概念と利点を理解する
- Playwright MCPの設定方法を習得する
- 自動テストの作成と実行方法を学ぶ
- テスト駆動開発の基礎を身につける

## 前提条件

- 前のセクションでテトリスゲームが完成していること
- Kiroがインストールされていること
- Node.jsがインストールされていること（Playwright用）

## MCPとは

### Model Context Protocol（MCP）の概念

**MCP**は、AI言語モデルが外部ツールやサービスと連携するための標準プロトコルです。Kiroでは、MCPを通じて様々な外部ツールを統合し、開発プロセスを自動化できます。

### MCPの利点

- **統一されたインターフェース**: 異なるツールを同じ方法で操作
- **拡張性**: 新しいツールを簡単に追加
- **自動化**: 手動作業の削減
- **一貫性**: 標準化されたワークフロー

### Playwright MCPの特徴

- **ブラウザ自動化**: Chrome、Firefox、Safariでの自動テスト
- **E2Eテスト**: エンドツーエンドのユーザーシナリオテスト
- **スクリーンショット**: 視覚的な確認とデバッグ
- **レポート**: 詳細なテスト結果レポート

## ステップ1: MCP設定の準備

### 1.1 設定ファイルの確認

Kiroのワークスペース設定を確認します：

```
.kiro/settings/mcp.json ファイルを確認してください。
もし存在しない場合は、MCP設定を作成する必要があります。
```

### 1.2 Playwright MCPの設定

Kiroのチャットで以下のように入力：

```
Playwright MCPを設定したいです。
.kiro/settings/mcp.json にPlaywright MCPの設定を追加してください。
```

**期待される設定例**:
```json
{
  "mcpServers": {
    "playwright": {
      "command": "uvx",
      "args": ["mcp-server-playwright"],
      "env": {
        "FASTMCP_LOG_LEVEL": "ERROR"
      },
      "disabled": false,
      "autoApprove": [
        "mcp_playwright_mcp_server_chrome_browser_navigate",
        "mcp_playwright_mcp_server_chrome_browser_snapshot",
        "mcp_playwright_mcp_server_chrome_browser_click",
        "mcp_playwright_mcp_server_chrome_browser_type"
      ]
    }
  }
}
```

### 1.3 設定の確認

設定が正しく適用されたことを確認：

```
MCP設定が正しく適用されているか確認してください。
Playwright MCPが利用可能になっているか教えてください。
```

## ステップ2: テスト環境の準備

### 2.1 テトリスゲームの起動

前のセクションで作成したテトリスゲームを起動：

```bash
cd tetris-game
python -m http.server 8000
```

ブラウザで `http://localhost:8000` にアクセスして、ゲームが正常に動作することを確認してください。

### 2.2 テスト計画の作成

テストしたい機能を整理：

1. **ページ読み込みテスト**: ゲームが正しく表示される
2. **基本操作テスト**: キーボード操作が動作する
3. **ゲーム機能テスト**: ブロックの移動と回転
4. **UI要素テスト**: スコア表示とゲームオーバー

## ステップ3: 基本的なテストの作成

### 3.1 最初のテスト作成

Kiroのチャットで以下のように入力：

```
Playwright MCPを使って、テトリスゲーム（http://localhost:8000）の基本的なテストを作成してください。

テスト内容：
1. ページが正しく読み込まれること
2. ゲームキャンバスが表示されること
3. スコア表示エリアが存在すること
```

### 3.2 テストの実行

Kiroがテストを作成したら、実行してみましょう：

```
作成したテストを実行してください。
結果を教えてください。
```

### 3.3 テスト結果の確認

テスト実行後の結果を確認：

- **成功したテスト**: 緑色で表示
- **失敗したテスト**: 赤色で表示、エラー詳細を確認
- **スクリーンショット**: 失敗時の画面状態を確認

## ステップ4: インタラクティブなテストの作成

### 4.1 キーボード操作テスト

より高度なテストを作成：

```
以下のキーボード操作テストを追加してください：

1. 左矢印キーでブロックが左に移動すること
2. 右矢印キーでブロックが右に移動すること
3. 上矢印キーでブロックが回転すること
4. スペースキーで高速落下すること
```

### 4.2 ゲーム状態のテスト

ゲームの状態変化をテスト：

```
ゲーム状態のテストを作成してください：

1. ゲーム開始時のスコアが0であること
2. ブロックが時間経過で落下すること
3. ライン消去でスコアが増加すること
```

### 4.3 エラーハンドリングテスト

異常系のテスト：

```
エラーハンドリングのテストを追加してください：

1. 無効なキー入力への対応
2. ゲームオーバー状態の処理
3. ブラウザリサイズへの対応
```

## ステップ5: テストの自動化と継続的実行

### 5.1 テストスイートの作成

複数のテストをまとめて実行：

```
これまで作成したテストをテストスイートとしてまとめてください。
全てのテストを一度に実行できるようにしてください。
```

### 5.2 テストレポートの生成

詳細なレポートを生成：

```
テスト実行結果の詳細レポートを生成してください。
以下の情報を含めてください：

- 実行時間
- 成功/失敗の詳細
- スクリーンショット
- エラーログ
```

### 5.3 継続的テストの設定

定期的なテスト実行の設定：

```
ファイル変更時に自動的にテストが実行されるよう設定してください。
Kiro Hooksを使用して実現してください。
```

## ステップ6: 高度なテスト技法

### 6.1 視覚的回帰テスト

画面の見た目をテスト：

```
視覚的回帰テストを実装してください：

1. ゲーム画面のスクリーンショットを取得
2. 基準画像との比較
3. 差分がある場合の報告
```

### 6.2 パフォーマンステスト

ゲームのパフォーマンスをテスト：

```
パフォーマンステストを追加してください：

1. ページ読み込み時間の測定
2. フレームレートの監視
3. メモリ使用量の確認
```

### 6.3 クロスブラウザテスト

複数ブラウザでのテスト：

```
Chrome、Firefox、Safariでのクロスブラウザテストを設定してください。
各ブラウザでの動作差異を確認してください。
```

## ステップ7: テスト結果の分析と改善

### 7.1 テスト結果の分析

テスト結果を詳しく分析：

```
テスト結果を分析して、以下の情報を提供してください：

1. 最も失敗しやすいテスト
2. 実行時間が長いテスト
3. 改善が必要な箇所
```

### 7.2 テストの改善

テストの品質向上：

```
テストの改善提案をしてください：

1. より安定したテストの書き方
2. 実行時間の短縮方法
3. メンテナンスしやすいテスト構造
```

### 7.3 テストカバレッジの向上

テスト範囲の拡大：

```
現在のテストでカバーできていない機能を特定し、
追加すべきテストケースを提案してください。
```

## ステップ8: 実践的な活用方法

### 8.1 開発ワークフローへの統合

日常的な開発プロセスに組み込む：

```
以下のワークフローを設定してください：

1. コード変更時の自動テスト実行
2. プルリクエスト作成時のテスト実行
3. デプロイ前の最終テスト実行
```

### 8.2 チーム開発での活用

チーム全体でのテスト活用：

```
チーム開発でPlaywright MCPを活用する方法を教えてください：

1. テスト結果の共有方法
2. テストケースの管理方法
3. 役割分担の考え方
```

### 8.3 トラブルシューティング

よくある問題と解決方法：

```
Playwright MCPでよく発生する問題と解決方法を教えてください：

1. テストが不安定になる原因
2. パフォーマンスの問題
3. 設定に関する問題
```

## 学習の振り返り

### 8.1 MCPの理解

今回学んだMCPの概念：

- **統合の力**: 外部ツールとのシームレスな連携
- **自動化の価値**: 手動テストからの脱却
- **品質向上**: 継続的なテスト実行による品質保証

### 8.2 Playwrightの活用

Playwrightテストで学んだこと：

- **E2Eテストの重要性**: ユーザー視点でのテスト
- **自動化の効果**: 効率的な品質管理
- **継続的改善**: テスト結果に基づく改善サイクル

### 8.3 次のステップ

さらなる学習のために：

- 他のMCPツールの探索（AWS、GitHub等）
- より複雑なテストシナリオの作成
- CI/CDパイプラインとの統合

## トラブルシューティング

### よくある問題と解決方法

#### 問題1: MCP設定が認識されない

**症状**: Playwright MCPが利用できない

**解決方法**:
```bash
# 設定ファイルの確認
cat .kiro/settings/mcp.json

# Kiroの再起動
# 設定の再読み込み
```

#### 問題2: テストが不安定

**症状**: 同じテストが成功したり失敗したりする

**解決方法**:
```
適切な待機時間の設定：
- 要素の読み込み待機
- アニメーション完了の待機
- 非同期処理の完了待機
```

#### 問題3: ブラウザが起動しない

**症状**: Playwrightがブラウザを起動できない

**解決方法**:
```bash
# 必要な依存関係のインストール
npx playwright install
npx playwright install-deps
```

## まとめ

このチュートリアルでは：

1. **MCPの概念**を理解
2. **Playwright MCPの設定**を実践
3. **自動テストの作成**を体験
4. **継続的テスト**の仕組みを構築
5. **品質向上**のプロセスを学習

MCPを活用することで、開発プロセスに自動テストをシームレスに統合し、より高品質なソフトウェア開発が可能になります。

次の章では、より本格的なアプリケーション開発に挑戦し、Kiroの高度な機能を活用していきましょう。

---

## 📚 学習進捗チェック

このセクションを完了したら、以下の項目ができるようになっているか確認してください：

- [ ] MCP（Model Context Protocol）の概念と利点を理解している
- [ ] Playwright MCPの設定ができる
- [ ] 基本的な自動テストを作成・実行できる
- [ ] テスト結果を分析して改善点を見つけられる
- [ ] 継続的テストの仕組みを理解している

---

<div align="center">

| [← 🎮 テトリス作成](tetris-tutorial.md) | [🏠 目次](../../README.md) | [💡 AI相談 →](../chapter2/ai-consultation.md) |
|:---:|:---:|:---:|

</div>

---

### 🔗 関連リソース
- [⚙️ MCP設定テンプレート](../../templates/mcp/)
- [🛠️ トラブルシューティング](../troubleshooting/common-issues.md)
- [❓ FAQ](../troubleshooting/faq.md)